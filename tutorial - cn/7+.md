## 7+. 创建新Creep(面向对象)
  - [CreepLogic类介绍](#creepLogic类介绍)
  - [创建行为](#创建行为)
  - [步进回调](#步进回调)
  - [实例化方法](#实例化方法)
  - [最终代码](#最终代码)

本节教程将介绍如何通过继承`CreepLogic`类来创建和管理爬虫，这是一种面向对象的、更结构化、更可维护的方式，并且拥有非常强大的逻辑控制能力。本节先从基础的部分讲起。

### CreepLogic类介绍

`CreepLogic`是爬虫逻辑的基类，继承链`...->Stage->Logic->CreepLogic`，提供了一系列与爬虫创建和管理相关的属性和方法。通过继承`CreepLogic`，可更方便地定义爬虫的行为和属性。

### 创建行为

通过设置以下主要的类变量，可控制爬虫的创建行为：

| 类变量 | 类型 | 默认值 | 描述 |
|-------|------|-------|------|
| `NAME` | `str` | - | 爬虫逻辑名称，创建爬虫时的类型标识。不能以数字结尾。 |
| `RECIPE` | `list[str]` \| `str` | `[MOVE]` 或 `M1` | 爬虫配方，定义爬虫的身体部件 |
| `OPTIMISE` | `bool` \| `int` \| `None` | `True` | 是否自动优化配方顺序以提高功能完存率 |
| `DIRECTION` | `int` | `None` | 爬虫出生方向，如LEFT、RIGHT、TOP等 |

### 步进回调

`CreepLogic`类提供了`onStep`回调方法，可重写此方法定义爬虫的行为。所有逻辑类的`onStep`回调都晚于`main.py`的`step`方法后执行。

`onStep`方法的函数形式：

| 参数名 | 类型 | 可选 | 默认值 | 描述 |
|-------|------|------|--------|------|
| `c` | `Creep` | 否 | - | Creep实例 |
| `k` | `GlobalKnowledge` | 否 | - | GlobalKnowledge全局知识 |
| `*refs` | `CreepLogic` | 是 | - | 由link创建的子实例 |

*注意：由于在JS环境中运行，你完全可以折叠不需要的参数:
```python
def onStep(self):  # 不会导致错误
    """每tick执行的逻辑"""
    pass
```

### 实例化方法

爬虫逻辑有三种实例化方式：

| 实例化方式 | 说明 | 示例 |
|-----------|------|------|
| `Logic("Mover", SPAWN)` | 通过基类`Logic`传入逻辑名称和参数 | `Logic("Mover", get.spawn())` |
| `CreepLogic("Mover", SPAWN)` | 通过基类`CreepLogic`传入逻辑名称和参数 | `CreepLogic("Mover", get.spawn())` |
| `MoverCreep(SPAWN)` | 直接使用具体子类传入参数 | `MoverCreep(get.spawn())` |

**实现原理**：
- `CreepLogic`使用Logic类的`__new__`方法实现了工厂模式
- 当第一个参数是字符串时，会通过`StageMachineLogicMeta.proto()`查找对应的原型类
- 然后使用该原型类创建实例，并传递剩余的参数

### 最终代码

以下是创建移动到旗帜的爬虫的完整示例：

```python
from builtin import *

class MoverCreep(CreepLogic):
    """移动到旗帜的爬虫逻辑"""
    NAME = "Mover"  # 爬虫逻辑名称
    RECIPE = [MOVE]  # 爬虫配方，只包含移动部件
    
    def onStep(self, creep: Creep, k: GlobalKnowledge):
        """每tick执行的逻辑"""
        # 根据uid决定移动到哪个flag
        creep.move(FLAGS[self.uid % 2])  # uid 从1开始

SPAWN = get.spawn()
FLAGS = get.flags()

def init(k: GlobalKnowledge):
    """初始化函数"""
    # 创建两个MoverCreep实例, 两种方法等价
    Logic("Mover", SPAWN)
    MoverCreep(SPAWN)

def step(k: GlobalKnowledge):
    """每tick执行的逻辑"""
    pass
```