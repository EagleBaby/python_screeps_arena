## 9. Building Construction
  - [Create Construction Site](#create-construction-site)
  - [Acquiring Objects](#acquiring-objects)
  - [Build Command](#build-command)
  - [Site Manager](#site-manager)
  - [Final Code](#final-code)

This tutorial teaches you how to create new buildings.

To construct buildings, we need to first create `ConstructionSite` (referred to as site).

### Create Construction Site

`plan` is a static method of `ConstructionSite`, used to create a construction site, constructed as:

| Parameter Name | Type | Optional | Default Value | Description |
|-------|------|----------|--------|-------------|
| `x` | `int` | No | - | x coordinate of construction site. |
| `y` | `int` | No | - | y coordinate of construction site. |
| `building_type` | `type` | No | - | Building type to create. e.g., `StructureTower`. |
| `single` | `bool` | Yes | `False` | Ensure site uniqueness. If `True`, cannot repeatedly create site at same location. |

| Return Value Type | Description |
|-----------|------|
| `int` \| `ConstructionSite` | Success returns `site` instance, failure returns error code \u003c 0. |

**Error Codes**:
- `OK` (0): Operation successful
- `ERR_NOT_OWNER` (-1): Not building owner
- `ERR_NAME_EXISTS` (-3): Construction site already exists at this location
- `ERR_INVALID_TARGET` (-7): Invalid target
- `ERR_FULL` (-8): Maximum number of construction sites reached
- `ERR_INVALID_ARGS` (-10): Incorrect parameters

*Note: Currently not allowed to create new site at tick=0, need to create in `init` function.


### Acquiring Objects

This tutorial provides a Creep with WORK part and an energy-filled `box`. Requires us to build a Tower.

```python
from builtin import *

SITE = None
CREEP = get.creep()
BOX = get.box()

def init(k: GlobalKnowledge):
    global SITE
    SITE = ConstructionSite.plan(50, 50, StructureTower)

```

### Build Command

`build` is an instance method of `Creep` class, constructed as:

| Parameter Name | Type | Optional | Default Value | Description |
|-------|------|----------|--------|-------------|
| `site` | `ConstructionSite` | No | - | Construction site to build |
| `move` | `MotionOptions` \| `bool` \| `None` | Yes | `None` | Passing `False` (`None` equivalent to `False`) disables movement. Passing `True` or `options` automatically approaches target when distance insufficient |

| Return Value Type | Description |
|-----------|------|
| `int` | Success returns `0`, failure returns error code \u003c 0, see `const.py`. |

**Note**: build requires Creep to consume corresponding amount of energy.

```python
# build is ranged command; fetch is resource command. They don't conflict, can be simultaneous
def step(k: GlobalKnowledge):
    CREEP.fetch(BOX)
    CREEP.build(SITE)
```

### Site Manager

For continuous building, limited by maximum 10 sites on map, managing site creation can become challenging. Can use `Site Manager` (`SitePlaner`) to manage site creation progress, breaking multiple Sites into single Site form to avoid logic issues from exceeding site limit.

#### SitePlaner Construction

`SitePlaner` construction parameter is a set of `SitePlan` instances. `SitePlan` construction is:

| SitePlan Parameter Name | Type | Optional | Default Value | Description |
|--------------|------|----------|--------|-------------|
| `ref` | `Point` | - | - | Reference point |
| `dx` | `int` | - | - | x offset relative to reference point |
| `dy` | `int` | - | - | y offset relative to reference point |
| `building_type` | `type` | - | - | Building type |

Example constructing `SitePlaner` with 1 Tower:

```python
SP = SitePlaner(
    SitePlan(Point(50, 50), 0, 0, StructureTower),
)
```

#### Get site

`next` is an instance method of `SitePlaner`, used to get `construction site` needed for current tick. This function has no parameters, returns `ConstructionSite` | `None`. Returns `None` after all building work completed or blocked, otherwise returns a site.

```python
def step(k: GlobalKnowledge):
    site = SP.next()
    if st.site(site):
        CREEP.fetch(BOX)
        CREEP.build(site)
```

#### Example: Build 3x3 Rampart area

```python
from builtin import *

P50 = Point(50, 50)
SP = SitePlaner(
    SitePlan(P50, -1, -1, StructureRampart),
    SitePlan(P50, -1,  0, StructureRampart),
    SitePlan(P50, -1,  1, StructureRampart),
    SitePlan(P50,  0, -1, StructureRampart),
    SitePlan(P50,  0,  0, StructureRampart),
    SitePlan(P50,  0,  1, StructureRampart),
    SitePlan(P50,  1, -1, StructureRampart),
    SitePlan(P50,  1,  0, StructureRampart),
    SitePlan(P50,  1,  1, StructureRampart),
    SitePlan(P50,  0,  0, StructureTower),
)
CREEP = get.creep()
BOX = get.box()

def init(k: GlobalKnowledge):
    pass


def step(k: GlobalKnowledge):
    site = SP.next()
    if st.site(site):
        CREEP.fetch(BOX)
        CREEP.build(site)
```

### Final Code

Complete code for building a Tower:

```python
from builtin import *

SITE = None
CREEP = get.creep()
BOX = get.box()

def init(k: GlobalKnowledge):
    global SITE
    SITE = ConstructionSite.plan(50, 50, StructureTower)


def step(k: GlobalKnowledge):
    CREEP.fetch(BOX)
    CREEP.build(SITE)
```

